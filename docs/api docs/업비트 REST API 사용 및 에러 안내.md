# REST API 사용 및 에러 안내

업비트 REST API 사용을 위한 요청, 인증, 에러 및 gzip 지원 관련 안내입니다.

## Endpoint 

https://api.upbit.com/v1

업비트 Open API는 회원님의 정보를 안전하게 보호하기 위해 TLS 1.2 이상 버전만 지원합니다. TLS 1.2 미만 버전은 더 이상 지원되지 않으므로, 최소 TLS 1.2 이상으로 업그레이드해 주시기 바랍니다.

- TLS 1.2 (최소 지원 버전)
- TLS 1.3 (권장 버전)

## Content Type

업비트 REST API는 application/json Content Type을 지원합니다. 특히 POST 요청의 경우, 본문(Body)을 JSON 형식으로 요청해야 하며 아래 헤더를 함께 지정하여 주시기 바랍니다.

Content-Type: application/json; charset=utf-8

POST API에 대한 Form 방식 요청은 2022년 3월 1일부로 지원이 종료되었습니다.
- Form 방식 지원 종료에 따라 Urlencoded Form 방식으로 전송하는 POST 요청에 대한 정상적인 동작을 보장하지 않습니다. 반드시 JSON 형식으로 요청 본문(Body)을 전송해주시기 바랍니다.

## 응답 상태 코드 및 에러 안내(https://docs.upbit.com/kr/reference/rest-api-guide)

업비트 REST API 응답으로 반환되는 HTTP 상태 코드 목록과 각 코드의 의미는 아래와 같습니다.


업비트 REST API 응답으로 반환되는 HTTP 상태 코드 목록과 각 코드의 의미는 아래와 같습니다.

| HTTP Status Code   | 관련 에러 코드                      | 발생 이유                                                                                 | 에러 해결 방법 |
| ------------------ | ----------------------------------- | ----------------------------------------------------------------------------------------- | -------------- |
| 200 OK             | \-                                  | 정상 응답                                                                                 | \-             |
| 201 Created        | \-                                  | 요청으로 인한                                                                             |
| 생성 완료          | \-                                  |
| 400 Bad Request    | `create_ask_error`,                 |
| `create_bid_error` | 주문 요청 정보가 올바르지 않습니다. | 시장가 주문임에도 가격을 입력하는 경우 발생할 수 있습니다. 주문 생성 문서를 참고해주세요. |

| `insufficient_funds_ask`,  
`insufficient_funds_bid` | 매수/매도 가능  
잔고가 부족합니다. | 잔고를 확인해주세요. |
| `under_min_total_ask`,  
`under_min_total_bid` | 최소 주문 금액에  
미달합니다. | 페어별 최소 주문 금액 확인 후 재요청해주세요. |
| `withdraw_address   _not_registered` | 허용되지 않은  
출금 주소입니다. | 등록된 출금 주소 목록에 포함되어 있는지 확인해주세요. |
| `validation_error` | 잘못된  
API 요청입니다. | 필수 파라미터 누락  
여부를 확인해주세요. |
| 401 Unauthorized | `invalid_query_payload` | JWT 페이로드가  
올바르지 않습니다. | [인증](https://docs.upbit.com/kr/reference/auth) 가이드 문서를 참고하여 서명이 올바르게 생성 되었는지 확인해주세요. |
| `jwt_verification` | JWT 검증에  
실패했습니다. | 토큰의 생성 및 서명 상태를 점검해주세요. |
| `expired_access_key` | API 키가  
만료되었습니다. | 새로운 키를 발급받아 사용해주세요. |
| `nonce_used` | 이미 사용된  
nonce 값입니다. | JWT에는 매 요청마다 새로운 nonce 값을 사용해야 합니다. |
| `no_authorization_ip` | 등록되지 않은  
IP입니다. | API 키 발급 시 등록한 IP 환경에서 호출 중인지 점검해주세요. |
| `no_authorization_token` | 인증 토큰이  
누락되었습니다. | 인증 헤더가 요청에 포함되었는지 확인해주세요. |
| `out_of_scope` | 지원 범위를 벗어난  
기능입니다. | API 키 발급 시 해당 기능을 포함했는지 확인해주세요. |
| 404 Not Found | \- | 존재하지 않는  
데이터에 접근 | 주문, 출금, 입금, 체결 등 요청 항목이 존재하지 않는 경우 |
| 418 I'm a teapot | \- | 과도한 요청으로  
인해 거부되었습니다. | IP 차단 등으로 요청이 제한됩니다. |
| 429 Too Many Requests | \- | 요청 제한을  
초과했습니다. | API 호출 한도를 초과했습니다. |
| 500 Internal Server Error | \- | 서버 내부 오류 | 서비스 점검 또는 시스템 오류로 인한 처리 불가 |

에러 발생 시, 응답은 다음과 같은 JSON 형식으로 반환됩니다. `name` 필드는 해당 에러의 코드를, `message` 필드는 오류와 관련된 메세지를 반환합니다. Quotation API는 정수 형식의 `name` 필드를, Exchange API는 문자열 형식의 `name` 필드를 반환합니다. 각 API 별 오류 예시는 API Reference 문서 우측 하단 응답 예시 영역을 참고하시기 바랍니다.

```json
{
  "error": {
    "name": 400,
    "message": "ERROR_MESSAGE"
  }
}
```

```json
{
  "error": {
    "name": "ERRPR_CODE",
    "message": "ERROR_MESSAGE"
  }
}
```

## 인코딩

GET 또는 DELETE API에 대해 쿼리 파라미터를 포함한 요청을 전송하는 경우 모든 쿼리 파라미터를 URL 인코딩 한 후 요청해야 합니다. 인코딩이 정상적으로 이루어지지 않은 요청에 대해 응답으로 400 Invalid parameter 에러가 발생할 수 있습니다. 단, Exchange API의 파라미터 중 배열 형식의 파라미터가 이름에 []를 포함하고 있는 경우, '[',']' 문자는 인코딩 대상에서 제외합니다.

#### URL 인코딩이란?
쉽게 말해, URL 인코딩은 URL 주소에 사용할 수 없는 특수 문자나 한글 등을 안전하게 전달 가능한 형태로 바꾸는 규칙입니다.

URL은 보통 알파벳, 숫자, 그리고 일부 특수 문자(-, _, ., ~)로만 구성됩니다. 그런데 공백(띄어쓰기), 콜론(:), 슬래시(/), 대괄호([]) 같은 다른 문자들은 URL에서 특별한 의미를 갖기 때문에 그냥 사용하면 주소가 깨지거나 서버가 잘못 알아들을 수 있습니다.

그래서 이런 문자들을 % 기호와 16진수 코드를 조합한 형태로 변환하는데, 이것이 바로 URL 인코딩입니다.
- :는 %3A로 변환
- +는 %2B로 변환
- 공백은 %20으로 변환

업비트 API에서의 인코딩 규칙
업비트 API에서 GET 또는 DELETE 방식으로 요청을 보낼 때, URL에 파라미터를 붙여 보내야 합니다. 이때 다음 규칙을 따라야 합니다.

모든 쿼리 파라미터는 반드시 URL 인코딩해야 합니다.

만약 인코딩을 제대로 하지 않으면, 서버가 파라미터를 이해하지 못해 400 Invalid parameter 오류를 반환합니다.

단, 한 가지 예외가 있습니다.
- 주문 UUID 목록(uuids[])이나 주문 상태 목록(states[])처럼, 파라미터 이름 자체에 대괄호([])가 포함된 경우가 있습니다.
- 이때는 대괄호 [와 ]는 인코딩하지 않고 그대로 둬야 합니다. 다른 문자들만 인코딩하면 됩니다.

#### 예시
만약 여러 개의 주문 상태(wait, watch)를 조회하고 싶다면, 파라미터는 states[]=wait&states[]=watch가 됩니다. 여기서 []는 그대로 두고, 다른 특수문자가 있다면 그것만 인코딩해서 보내야 합니다.

결론적으로, API 요청 시 URL에 포함되는 모든 파라미터 값은 URL 인코딩하는 것이 원칙이지만, 파라미터 이름에 있는 []는 예외적으로 인코딩하면 안 된다는 점을 기억하시면 됩니다.

배열은 서버가 '이건 배열 데이터구나!' 하고 쉽게 알아채게 하려는 약속(convention)이기 때문에 인코딩 하면 안됨. 




## gzip 응답 지원

인코딩 옵션을 gzip으로 요청하여 REST API 응답을 gzip 압축된 형태로 수신할 수 있습니다. gzip 형식으로 요청 시 API를 통해 주고 받는 데이터 크기를 줄여 트래픽 비용 및 응답 시간을 절감할 수 있습니다. gzip 인코딩은 시세(Quotation) API만 지원합니다. gzip 옵션 사용 시 아래와 같이 헤더를 지정합니다.






